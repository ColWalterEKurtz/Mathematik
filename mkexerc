#!/bin/bash

# ------------------------------------------------------------------------------
# settings                                                              settings
# ------------------------------------------------------------------------------
set -o errtrace  # any trap on ERR is inherited by shell functions,
                 #   command substitutions, and commands executed in a subshell
                 #   environment
set -o nounset   # treat unset variables and parameters other than the special
                 #   parameters "@" and "*" as an error when performing
                 #   parameter expansion
set -o pipefail  # the return value of a pipeline is the value of the last
                 #   (rightmost) command to exit with a non-zero status, or
                 #   zero if all commands in the pipeline exit successfully

# set language
export LANG="en_US.UTF-8"

# use dot as decimal separator
export LC_NUMERIC="en_US.UTF-8"

# ------------------------------------------------------------------------------
# commands                                                              commands
# ------------------------------------------------------------------------------

# get unique ID
ID=$(date -uIns | sha1sum | sed -re "s/ .+//")

# start group
echo "\\begin{exercise}"
echo "      {ID-$ID}"
echo "      {TITLE}"
echo "  \\ifproblem\\problem"

# insert indent and remove trailing spaces
sed -re "s/^/    / ; s/[[:space:]]+$//"

# finish group
echo "  \\fi"
echo "  %\\ifoutline\\outline"
echo "  %  \\begingroup"
echo "  %    \\dimen1=5cm%"
echo "  %    \\begin{minipage}{\\dimen1}%"
echo "  %      \\begin{tikzpicture}%"
echo "  %      \\end{tikzpicture}%"
echo "  %    \\end{minipage}%"
echo "  %    \\dimen2=\\linewidth%"
echo "  %    \\advance\\dimen2 by -\\dimen1%"
echo "  %    \\begin{minipage}{\\dimen2}%"
echo "  %      \\setlength{\\abovedisplayskip}{0pt}%"
echo "  %      \\begin{equation*}"
echo "  %      \\end{equation*}"
echo "  %    \\end{minipage}%"
echo "  %  \\endgroup"
echo "  %\\fi"
echo "  %\\ifoutcome\\outcome"
echo "  %\\fi"
echo "\\end{exercise}"

exit 0

